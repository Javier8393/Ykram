---
import Icon from "./Icon.astro";

// Determinar el idioma basado en la URL
const lang = Astro.url.pathname.startsWith('/en') ? 'en' : 'es';

// Textos según el idioma
const texts = {
    es: {
        title: "Clientes",
        subtitle: "Empresas con las que he tenido el placer de trabajar:",
        clientes: [
            {
                imagen: "../assets/clientes/01_op_Alan.jpg",
                nombre: "Alan M.Donald",
                puesto: "Director de arte Kodem",
                valoracion: "¡Trabajar con Ykram es excelente! Es un artista responsable, comprometido, diligente y profesional, además de que la claridad de sus ilustraciones jamás decepciona. ¡Recomiendo ampliamente su trabajo!",
            },
            {
                imagen: "../assets/clientes/02_op_David.jpg",
                nombre: "David Salvador Saez",
                puesto: "Escritor y docente",
                valoracion: "Mi primer libro de literatura infantil y juvenil fue ilustrado por Ykram. Tuvo la capacidad de mejorar el diseño anterior de mi personaje principal y destacó en todo momento por su profesionalidad, cordialidad y capacidad de trabajo. Gracias por todo",
            },
            {
                imagen: "../assets/clientes/03_op_Alejandro.jpg",
                nombre: "Alejandro Mozos Fernández",
                puesto: 'Creador de "El favor del Rey"',
                valoracion: "Contacté casi por suerte con Ykram a través de un post cuando buscaba ilustrador para mi juego de mesa. Rápidamente cogimos química cuando le conté sobre el proyecto y le dio vida a cada una de sus cartas y personajes, en tiempo récord, y con una calidad de detalle increíble. Dudo que hubiese podido quedar mejor el proyecto. Muy agradecido con él.",
            },
            {
                imagen: "../assets/clientes/04_op_Fran.jpg",
                nombre: "Fran Grybbus",
                puesto: "Creador de contenido",
                valoracion: "Contacté con Ykram para colaborar con mi proyecto de creación de contenido, la experiencia fue gratamente sorprendente, me ayudó a desarrollar ilustraciones acordes a mi marca personal de forma eficaz para youtube, instagram y twitch.¡Gran profesional y mejor artista!",
            },
            {
                imagen: "../assets/clientes/machango_games.jpg",
                nombre: "Machango Games",
                puesto: "Estudio de juegos de mesa",
                valoracion: "Nuestro primer juego fue ilustrado por Ykram tras valorar a muchos ilustradores y desde que nos dio el boceto supimos que queríamos trabajar con él. No se limita a diseñar lo que le solicitas sino que le da una lógica y un toque personal que llama la atención desde el inicio. Tomó el proyecto como suyo y se implicó al máximo para subir al juego a otro nivel. ¡Muchísimas gracias!",
            },
        ]
    },
    en: {
        title: "Clients",
        subtitle: "Companies I've had the pleasure to work with:",
        clientes: [
            {
                imagen: "../assets/clientes/01_op_Alan.jpg",
                nombre: "Alan M.Donald",
                puesto: "Art Director at Kodem",
                valoracion: "Working with Ykram is excellent! He is a responsible, committed, diligent and professional artist, and the clarity of his illustrations never disappoints. I highly recommend his work!",
            },
            {
                imagen: "../assets/clientes/02_op_David.jpg",
                nombre: "David Salvador Saez",
                puesto: "Writer and teacher",
                valoracion: "My first children's and youth literature book was illustrated by Ykram. He was able to improve the previous design of my main character and stood out at all times for his professionalism, cordiality and work capacity. Thank you for everything",
            },
            {
                imagen: "../assets/clientes/03_op_Alejandro.jpg",
                nombre: "Alejandro Mozos Fernández",
                puesto: 'Creator of "The King\'s Favor"',
                valoracion: "I almost luckily contacted Ykram through a post when I was looking for an illustrator for my board game. We quickly clicked when I told him about the project and he brought to life each of its cards and characters, in record time, and with incredible detail quality. I doubt the project could have turned out better. Very grateful to him.",
            },
            {
                imagen: "../assets/clientes/04_op_Fran.jpg",
                nombre: "Fran Grybbus",
                puesto: "Content Creator",
                valoracion: "I contacted Ykram to collaborate with my content creation project, the experience was pleasantly surprising, he helped me develop illustrations according to my personal brand effectively for youtube, instagram and twitch. Great professional and even better artist!",
            },
            {
                imagen: "../assets/clientes/machango_games.jpg",
                nombre: "Machango Games",
                puesto: "Board Game Studio",
                valoracion: "Our first game was illustrated by Ykram after evaluating many illustrators and from the moment he gave us the sketch we knew we wanted to work with him. He doesn't just design what you ask for, but gives it logic and a personal touch that catches attention from the start. He took the project as his own and was fully involved in taking the game to another level. Thank you very much!",
            },
        ]
    }
};

const currentTexts = texts[lang];
---

<section class="box clients">
    <h3>
        <Icon icon="clients" color="var(--accent-regular)" size="2.5rem" />
        {currentTexts.title}
    </h3>
    <p>{currentTexts.subtitle}</p>
    <div class="cliente-wrapper">
        <div class="cliente">
            <div class="cliente-track">
                {
                    currentTexts.clientes.map(({ imagen, nombre, puesto, valoracion }) => (
                        <div class="cliente-slide">
                            <div class="cliente-img">
                                <img src={imagen} alt={nombre} class="cliente-imagen" />
                            </div>
                            <div class="cliente-info">
                                <h3>{nombre}</h3>
                                <h6>{puesto}</h6>
                            </div>
                            <div class="cliente-valoracion">
                                <p>{valoracion}</p>
                            </div>
                        </div>
                    ))
                }
            </div>
            <button class="cliente-button prev" aria-label="Anterior">
                <Icon icon="arrow-left" color="var(--accent-regular)" size="2rem" />
            </button>
            <button class="cliente-button next" aria-label="Siguiente">
                <Icon icon="arrow-right" color="var(--accent-regular)" size="2rem" />
            </button>
        </div>
    </div>
    <img src="/assets/empresas.png" alt="empresas" class="empresas" />
</section>

<style>
.box {
    border: 1px solid var(--gray-800);
    border-radius: 1rem;
    padding: 2rem;
    background-color: var(--gray-999);
    box-shadow: var(--shadow-sm);
    margin: auto;
    width: 100%;
}

.cliente-wrapper {
    position: relative;
    width: 100%;
    overflow: hidden;
}

.cliente {
    position: relative;
    width: 100%;
    padding: 0 1.5rem;
}

.cliente-track {
    display: flex;
    transition: transform 0.5s ease-in-out;
}

.cliente-slide {
    flex: 0 0 100%;
    width: 100%;
    padding: 3rem;
    display: grid;
    grid-template-columns: auto 1fr;
    grid-template-rows: auto auto;
    gap: 1.5rem;
    align-items: start;
}

.cliente-img {
    grid-column: 1;
    grid-row: 1 / span 2;
}

.cliente-info {
    grid-column: 2;
    grid-row: 1;
}

.cliente-valoracion {
    grid-column: 2;
    grid-row: 2;
}

.cliente-img img {
    max-width: 150px;
    border-radius: 8px;
}

.cliente-info h3 {
    margin: 0;
    color: var(--gray-50);
    font-size: var(--text-xl);
}

.cliente-info h6 {
    margin: 0.5rem 0 0;
    font-size: var(--text-lg);
    color: var(--gray-300);
}

.cliente-valoracion p {
    margin: 0;
    font-size: var(--text-lg);
    color: var(--gray-300);
}

.cliente-button {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: var(--gray-999);
    border: 1px solid var(--gray-800);
    border-radius: 50%;
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s ease;
}

.cliente-button:hover {
    background: var(--gray-800);
    transform: translateY(-50%) scale(1.1);
}

.cliente-button.prev {
    left: 0;
}

.cliente-button.next {
    right: 0;
}

@media (max-width: 50em) {
    .cliente {
        padding: 0 1.5rem;
    }
    
    .cliente-slide {
        display: flex;
        flex-direction: column;
        padding: 1.5rem;
        gap: 1rem;
    }

    .cliente-info {
        order: 1;
    }

    .cliente-img {
        order: 2;
    }

    .cliente-valoracion {
        order: 3;
    }

    .cliente-info h3 {
        font-size: var(--text-md);
    }

    .cliente-info h6,
    .cliente-valoracion p {
        font-size: var(--text-sm);
    }

    .cliente-button {
        width: 2.5rem;
        height: 2.5rem;
    }
}

@media (max-width: 480px) {
    .cliente-button {
        width: 2rem;
        height: 2rem;
    }
}
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const track = document.querySelector('.cliente-track') as HTMLElement;
    const slides = document.querySelectorAll('.cliente-slide');
    const nextButton = document.querySelector('.cliente-button.next') as HTMLElement;
    const prevButton = document.querySelector('.cliente-button.prev') as HTMLElement;

    if (!track || !slides.length) {
      return;
    }

    let currentIndex = 0;
    let autoplayInterval: ReturnType<typeof setInterval> | null = null;

    function updatecliente() {
      track.style.transform = `translateX(-${currentIndex * 100}%)`;
    }

    function showNextSlide() {
      currentIndex = (currentIndex + 1) % slides.length;
      updatecliente();
    }

    function showPrevSlide() {
      currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      updatecliente();
    }

    function startAutoplay() {
      if (autoplayInterval) {
        clearInterval(autoplayInterval);
      }
      autoplayInterval = setInterval(() => {
        showNextSlide();
      }, 6000); // 6 segundos entre slides
    }

    function stopAutoplay() {
      if (autoplayInterval) {
        clearInterval(autoplayInterval);
        autoplayInterval = null;
      }
    }

    function handleManualNavigation() {
      stopAutoplay();
      // Reiniciar el autoplay después de 4 segundos
      setTimeout(() => {
        startAutoplay();
      }, 4000);
    }

    // Event listeners para los botones
    nextButton?.addEventListener('click', () => {
      showNextSlide();
      handleManualNavigation();
    });

    prevButton?.addEventListener('click', () => {
      showPrevSlide();
      handleManualNavigation();
    });

    // Iniciar autoplay al cargar
    startAutoplay();

    // Limpiar el intervalo cuando el componente se desmonte
    return () => {
      stopAutoplay();
    };
  });
</script>

